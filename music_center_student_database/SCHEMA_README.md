# Music Center Student Registration - MySQL Schema

This folder contains the schema for the MySQL database powering the student registration app.

Contents:
- schema.sql: Human-readable schema with tables, constraints, and seed data.
- schema_apply_commands.sql: One-line SQL statements suitable for execution via mysql -e "...".
- apply_schema.sh: Helper script that reads db_connection.txt and executes each line from schema_apply_commands.sql using mysql -e "SQL_STATEMENT".

MySQL container notes:
- Connection details are stored in db_connection.txt (generated by startup.sh).
- Always execute SQL via one-line mysql -e "..." commands, per container rules.

Apply schema automatically:
- startup.sh will attempt to run apply_schema.sh after MySQL is initialized.

Apply schema manually:
1) Ensure MySQL is running (use startup.sh).
2) Source connection info:
   cat db_connection.txt
3) Run the helper:
   bash apply_schema.sh

Or run commands individually (examples):
- Create DB:
  $(cat db_connection.txt | sed 's/ myapp$//') -e "CREATE DATABASE IF NOT EXISTS myapp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
- Create tables:
  $(cat db_connection.txt | sed 's/ myapp$//') -e "USE myapp; CREATE TABLE IF NOT EXISTS instruments (id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY, name VARCHAR(100) NOT NULL UNIQUE, family VARCHAR(100) NULL, created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;"

Verify schema:
- List tables:
  $(cat db_connection.txt | sed 's/ myapp$//') -e "USE myapp; SHOW TABLES;"
- Check seeded instruments:
  $(cat db_connection.txt | sed 's/ myapp$//') -e "USE myapp; SELECT * FROM instruments LIMIT 20;"
- Check view:
  $(cat db_connection.txt | sed 's/ myapp$//') -e "USE myapp; SELECT * FROM v_student_registrations LIMIT 10;"

Example inserts:
- Create a student:
  $(cat db_connection.txt | sed 's/ myapp$//') -e "USE myapp; INSERT INTO students (first_name,last_name,email,phone,city,country) VALUES ('Alice','Nguyen','alice@example.com','+1-555-111-2222','Seattle','USA');"
- Register the student for Piano (assuming instrument exists):
  $(cat db_connection.txt | sed 's/ myapp$//') -e "USE myapp; INSERT INTO registrations (student_id,instrument_id,skill_level,registration_date,status) VALUES (1,(SELECT id FROM instruments WHERE name='Piano'),'beginner',CURDATE(),'active');"

